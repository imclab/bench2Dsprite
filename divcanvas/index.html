<body>
	<script src="vendor/requestanimationframe.js"></script>
	<script src="vendor/Stats.js"></script>
	<script src="../vendor/gowiththeflow.js"></script>
	<script>
		function bench(nImages, nSeconds, callback){
			var canvas = document.createElement("canvas");  
			canvas.width	= 640;
			canvas.height	= 480;
			document.body.appendChild(canvas);

			var ctx		= canvas.getContext("2d");
			
			var image	= new Image();
			image.onload	= function(){
				start();
			};
			image.crossOrigin= '';
			image.src	= "logo128.png";			
	

			var timeStart, nFrame;

			function start(){
				timeStart	= Date.now();
				nFrame		= 0;
				requestAnimationFrame(anim);
			}
			function anim(){
				var deltaSeconds= (Date.now() - timeStart)/1000
				if( deltaSeconds > nSeconds && timeStart ){
					//console.log("nFrame", nFrame);
					//console.log("nImages", nImages);
					//console.log("deltaSeconds", deltaSeconds);
					var imageSecond	= (nFrame*nImages)/deltaSeconds;
					canvas.parentNode.removeChild(canvas);
					callback && callback(imageSecond, nFrame, nImages);
					return;
				}

				requestAnimationFrame(anim);

				ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
				var width	= ctx.canvas.width;
				var height	= ctx.canvas.height;
				
				var speed	= Date.now()/10;
				for(var i = 0; i < nImages; i++){
					var x	= Math.floor(speed+i)	% 640;
					var y	= Math.floor(speed+i)*3	% 480;
					ctx.drawImage(image, x, y)
				}
				nFrame++;
			}			
		}

		var params	= [
			{ nImages	: 3000,
			  nSeconds	: 10,
			},
			{ nImages	: 3000,
			  nSeconds	: 10,
			},
			{ nImages	: 3000,
			  nSeconds	: 10,
			},
		];

		var flow	= Flow();
		params.forEach(function(item){
			var nImages	= item.nImages;
			var nSeconds	= item.nSeconds;
			flow.seq(function(next){
				bench(nImages, nSeconds,function(imagesSeconds, nFrame, nImages){
					console.log("***** Results")
					console.log("imageSeconds", imagesSeconds, imagesSeconds/30)
					next();
				});
			});
		});		
	</script>
</body>