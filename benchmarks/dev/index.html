<body>
	<script src="../vendor/requestanimationframe.js"></script>
	<script src="../vendor/Stats.js"></script>
	<script src="../vendor/gowiththeflow.js"></script>
	<script src="../vendor/jquery.js"></script>

	<!--[if lte IE 8]><script src="../vendor/excanvas.min.js"></script><![endif]-->
	<script src="../vendor/jquery.js"></script>
	<script src="../vendor/jquery.flot.js"></script>

	<script src="../assets/js/utils.js"></script>
	<script src="./benchcanvas.js"></script>

	<script>
		function benchCanvas(nImages, nSeconds, callback){
			var timeStart, nFrame;
			var canvas	= createCanvas(900,400);
			document.body.appendChild(canvas);
			var ctx		= canvas.getContext("2d");
			var image	= loadImage('../assets/images/logo128.png', function(){
				timeStart	= Date.now();
				nFrame		= 0;
				setTimeout(anim, 0);
			});
			function anim(){
				var deltaSeconds= (Date.now() - timeStart)/1000
				if( deltaSeconds > nSeconds && timeStart ){
					var imagesRate	= (nFrame*nImages)/deltaSeconds;
					canvas.parentNode && canvas.parentNode.removeChild(canvas);
					callback && callback(imagesRate, nFrame, nImages);
					return;
				}

				setTimeout(anim, 0);

				ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
				var width	= ctx.canvas.width;
				var height	= ctx.canvas.height;
				
				var speed	= Math.floor(Date.now()/10);
				var x 	= 900/2, y = 400/2;
				for(var i = 0; i < nImages; i++){
					var x	= Math.floor(speed+i)*3	% 900;
					var y	= Math.floor(speed+i)	% 400;
					ctx.drawImage(image, x, y)
				}
				nFrame++;
			}			
		}

		benchCanvas(10000, 5,function(imagesRate, nFrame, nImages){
			console.log("Results: imageRate", imagesRate, imagesRate/30)
		});
	</script>
</body>